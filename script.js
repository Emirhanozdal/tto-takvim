document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("year-view"),t=document.getElementById("month-view"),n=document.getElementById("user-panel"),l=document.getElementById("year-str"),a=document.getElementById("year-view-body"),i=document.getElementById("month-year-str"),d=document.getElementById("calendar-grid-container"),s=document.getElementById("entry-modal"),r=document.getElementById("manage-modal"),m=document.getElementById("details-modal"),o=new Date,c=o.getFullYear(),g=JSON.parse(localStorage.getItem("tto_takvim_entries"))||{},y=["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eyl\xfcl","Ekim","Kasım","Aralık"],p=["Pzt","Sal","\xc7ar","Per","Cum","Cmt","Paz"],E=!1,v=e=>{E=!!e,document.body.classList.toggle("admin-mode",E),e?(n.innerHTML=`<span>${e.email}</span><button id="logout-btn">\xc7ıkış Yap</button>`,document.getElementById("logout-btn").addEventListener("click",()=>netlifyIdentity.logout())):n.innerHTML=`<a href="/inNout.html">Giriş Yap</a>`,L(),t.classList.contains("hidden")||I()};window.netlifyIdentity&&(netlifyIdentity.on("init",e=>v(e)),netlifyIdentity.on("login",e=>{v(e)}),netlifyIdentity.on("logout",()=>v(null)));let u=()=>{e.classList.remove("hidden"),t.classList.add("hidden"),L()},h=()=>{e.classList.add("hidden"),t.classList.remove("hidden"),I()},L=()=>{l.textContent=c,a.innerHTML="";for(let e=0;e<12;e++){let t=document.createElement("div");t.className="mini-calendar",t.addEventListener("click",()=>{o=new Date(c,e,1),h()});let n=document.createElement("div");n.className="mini-calendar-header",n.textContent=y[e];let i=document.createElement("div");i.className="mini-day-names",p.forEach(e=>i.innerHTML+=`<div>${e}</div>`);let d=document.createElement("div");d.className="mini-day-grid";let s=new Date(c,e,1),r=new Date(c,e+1,0).getDate(),m=0===s.getDay()?6:s.getDay()-1;for(let E=0;E<m;E++)d.innerHTML+='<div class="mini-day"></div>';for(let v=1;v<=r;v++){let u=document.createElement("div");u.className="mini-day",u.textContent=v;let L=`${c}-${String(e+1).padStart(2,"0")}-${String(v).padStart(2,"0")}`;g[L]&&u.classList.add("has-event");let I=`${c}-${String(e+1).padStart(2,"0")}`;g[I]&&g[I].some(e=>"project"===e.type)&&u.classList.add("is-project");let B=new Date;v===B.getDate()&&e===B.getMonth()&&c===B.getFullYear()&&u.classList.add("is-today"),d.appendChild(u)}t.append(n,i,d),a.appendChild(t)}},I=()=>{d.innerHTML="";let e=o.getFullYear(),t=o.getMonth();i.textContent=`${y[t]} ${e}`;let n=`${e}-${String(t+1).padStart(2,"0")}`,l=g[n]?.filter(e=>"project"===e.type)||[],a=l.length>0;document.getElementById("manage-projects-btn").classList.toggle("hidden",!(E&&a)),p.forEach(e=>{let t=document.createElement("div");t.className="day-name",t.textContent=e,d.appendChild(t)});let s=new Date(e,t,1),r=0===s.getDay()?7:s.getDay(),m=new Date(s);m.setDate(m.getDate()-(r-1));for(let c=0;c<42;c++){let v=new Date(m);v.setDate(m.getDate()+c);let u=document.createElement("div");u.classList.add("day");let h=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}`;v.getMonth()!==t?u.classList.add("prev-next-month-day"):a&&u.classList.add("project-month-day");let L=new Date;v.getDate()===L.getDate()&&v.getMonth()===L.getMonth()&&v.getFullYear()===L.getFullYear()&&u.classList.add("today"),u.innerHTML=`<div class="day-number">${v.getDate()}</div>`;let I=g[h]?.some(e=>"event"===e.type);if(I){let B=document.createElement("div");B.classList.add("event-list-day"),g[h].filter(e=>"event"===e.type).forEach(e=>{B.innerHTML+=`<div class="event-item-day">${e.title}</div>`}),u.appendChild(B)}if(E){if(v.getMonth()===t){let b=document.createElement("button");b.className="add-day-btn",b.textContent="+",b.addEventListener("click",e=>{e.stopPropagation(),f(h)}),u.appendChild(b)}I&&(u.classList.add("clickable"),u.addEventListener("click",()=>k(h)))}d.appendChild(u)}},B=e=>{let t=e.querySelector(".close-btn");t.addEventListener("click",()=>e.style.display="none"),e.addEventListener("click",t=>{t.target===e&&(e.style.display="none")})};[s,r,m].forEach(B);let f=e=>{s.querySelector("form").reset(),M(),document.getElementById("type-event").checked=!0,document.getElementById("event-date-input").value=e,M(),s.style.display="flex"},k=e=>{let t=g[e]?.find(e=>"event"===e.type);if(!t)return;let n=new Date(e+"T00:00:00"),l=`${n.getDate()} ${y[n.getMonth()]} ${n.getFullYear()}`;document.getElementById("details-title").textContent=t.title,document.getElementById("details-date").textContent=l;let a=document.getElementById("details-media-container");if(a.innerHTML="",t.imageUrl){if(t.imageUrl.includes("instagram.com")){let i=document.createElement("blockquote");i.className="instagram-media",i.setAttribute("data-instgrm-permalink",t.imageUrl),a.appendChild(i),window.instgrm&&window.instgrm.Embeds.process()}else a.innerHTML=`<img src="${t.imageUrl}" alt="Etkinlik G\xf6rseli">`;a.classList.remove("hidden")}else a.classList.add("hidden");document.getElementById("manage-event-btn").onclick=()=>{m.style.display="none",b(e)},m.style.display="flex"},b=e=>{let t=7===e.length,n=t?"project":"event";document.getElementById("manage-modal-title").textContent=`${"event"===n?"Etkinlikleri":"Projeleri"} Y\xf6net`;let l=document.getElementById("manage-modal-date");if(t)l.textContent="";else{let a=new Date(e+"T00:00:00");l.textContent=`${a.getDate()} ${y[a.getMonth()]} ${a.getFullYear()}`}let i=document.getElementById("entry-list");i.innerHTML="";let d=g[e]?.filter(e=>e.type===n)||[];0===d.length?i.innerHTML="<li>Silinecek kayıt bulunmuyor.</li>":d.forEach((t,n)=>{let l=document.createElement("li");l.innerHTML=`<span>${t.title}</span><button class="delete-btn" data-key="${e}" data-index="${n}">Sil</button>`,i.appendChild(l)}),r.style.display="flex"};document.getElementById("entry-list").addEventListener("click",e=>{if(e.target.classList.contains("delete-btn")){let n=e.target.dataset.key,l=parseInt(e.target.dataset.index),a=7===n.length?"project":"event",i=0,d=-1;for(let s=0;s<g[n].length;s++)if(g[n][s].type===a){if(i===l){d=s;break}i++}-1!==d&&(g[n].splice(d,1),0===g[n].length&&delete g[n],localStorage.setItem("tto_takvim_entries",JSON.stringify(g)),I(),t.classList.contains("hidden")&&L(),r.style.display="none")}});let $=document.getElementById("entry-form"),M=()=>{let e=document.getElementById("type-event").checked;document.getElementById("event-inputs").classList.toggle("hidden",!e),document.getElementById("project-inputs").classList.toggle("hidden",e),document.getElementById("event-title-input").required=e,document.getElementById("event-date-input").required=e,document.getElementById("project-title-input").required=!e,document.getElementById("project-month-input").required=!e};$.addEventListener("submit",e=>{e.preventDefault();let n=document.querySelector('input[name="entry-type"]:checked').value,l,a;if("event"===n){let i=document.getElementById("event-title-input").value.trim(),d=document.getElementById("event-date-input").value,r=document.getElementById("event-image-input").value.trim();if(!i||!d)return;l=d,a={type:"event",title:i,imageUrl:r||""}}else{let m=document.getElementById("project-title-input").value.trim(),o=document.getElementById("project-month-input").value;if(!m||!o)return;l=o,a={type:"project",title:m}}g[l]||(g[l]=[]),g[l].push(a),localStorage.setItem("tto_takvim_entries",JSON.stringify(g)),t.classList.contains("hidden")?L():I(),s.style.display="none"}),document.getElementById("prev-year-btn").addEventListener("click",()=>{c--,L()}),document.getElementById("next-year-btn").addEventListener("click",()=>{c++,L()}),document.getElementById("prev-month-btn").addEventListener("click",()=>{o.setMonth(o.getMonth()-1),I()}),document.getElementById("next-month-btn").addEventListener("click",()=>{o.setMonth(o.getMonth()+1),I()}),document.getElementById("today-btn").addEventListener("click",()=>{o=new Date,h()}),document.getElementById("back-to-year-view-btn").addEventListener("click",u),document.querySelectorAll('input[name="entry-type"]').forEach(e=>e.addEventListener("change",M)),document.getElementById("manage-projects-btn").addEventListener("click",()=>{let e=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`;b(e)}),u()});
